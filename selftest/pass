
sub dot33 {                    # ( n -- ) print as nnn:nnn
   lesshash                    
   bl hold
   3:hash
   58 hold
   3:hash
   hashmoretype
}

sub accumulate { 10 * + }
sub emptyall  {
   depth$ times drop$
   depth times drop
}

sub emptybuffer {
   movefilestart blockbegin
   movefileend    blockend
   blockkill                # fails if buffer empty. force to continue
}

sub testfilename { var$ new }


sub beforealltests {
   emptybuffer
   "selftest started" type$ cr
   }


sub afteralltests {
   "selftest finished" type$ cr
   }


sub pass   {    # ( got wants testnum -- )  ( filename$ -- )
   tor
      dup2 equals
      depth depth$ accumulate 13 equals and
      if "PASS" else "FAIL" endif type$
   rfrom 
   " test " type$ dot33
   "wanted" type$ 9 dotr
   ", got"  type$ 9 dotr
   3 spaces type$ cr
   emptyall
   filesave
}

